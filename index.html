<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quinntessential 3D</title>
<style>
  /* COLORS */
  :root {
    --background: #F37431;
    --header: #1A3D7C;
    --header-line: #155A8D;
    --box-button: #00A8FF;
    --file-upload: #FFD966;
  }

  body {
    margin: 0;
    font-family: Arial, sans-serif;
    background-color: var(--background);
    color: #fff;
  }

  /* STICKY HEADER */
  header {
    position: sticky;
    top: 0;
    background-color: var(--header);
    padding: 20px;
    z-index: 1000;
    border-bottom: 5px solid var(--header-line);
  }

  header h1 {
    margin: 0;
  }

  /* PRODUCT CARDS */
  .products {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    padding: 20px;
  }

  .product-card {
    background-color: var(--box-button);
    color: #000;
    padding: 20px;
    margin: 10px;
    border-radius: 10px;
    width: 250px;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .product-card input, .product-card select, .product-card button {
    padding: 8px;
    border-radius: 5px;
    border: none;
  }

  .product-card button {
    background-color: var(--box-button);
    color: #fff;
    cursor: pointer;
    font-weight: bold;
  }

  /* CART */
  #cart {
    padding: 20px;
    background-color: #222;
  }

  #cart h2 {
    margin-top: 0;
  }

  .cart-item {
    display: flex;
    justify-content: space-between;
    margin-bottom: 10px;
    padding: 10px;
    background-color: #333;
    border-radius: 5px;
  }

  .checkout-button {
    background-color: var(--box-button);
    color: #fff;
    padding: 10px 20px;
    font-weight: bold;
    border: none;
    cursor: pointer;
    margin-top: 10px;
  }

  /* FILE UPLOAD */
  input[type="file"] {
    background-color: var(--file-upload);
  }
</style>
</head>
<body>

<header>
  <h1>Quinntessential 3D</h1>
</header>

<section class="products">
  <div class="product-card">
    <h3>Custom 3D Print</h3>
    <label>Upload STL/OBJ/Other:</label>
    <input type="file" accept=".stl,.obj,.fbx,.3mf" class="file-upload" required>
    <label>Select Filament Color:</label>
    <select class="color-select" required>
      <option value="">Choose color</option>
      <option value="green">Green</option>
      <option value="grey">Grey</option>
      <option value="black">Black</option>
    </select>
    <button class="add-to-cart">Add to Cart</button>
  </div>
</section>

<section id="cart">
  <h2>Your Cart</h2>
  <div id="cart-items"></div>
  <button class="checkout-button" id="checkout-button">Proceed to Checkout</button>
</section>

<script src="https://js.stripe.com/v3/"></script>
<script>
  const cart = [];
  const cartItemsDiv = document.getElementById('cart-items');

  function renderCart() {
    cartItemsDiv.innerHTML = '';
    cart.forEach((item, index) => {
      const div = document.createElement('div');
      div.className = 'cart-item';
      div.innerHTML = `
        <span>${item.name} - ${item.color} - ${item.fileName}</span>
        <button onclick="removeItem(${index})">Remove</button>
      `;
      cartItemsDiv.appendChild(div);
    });
  }

  function removeItem(index) {
    cart.splice(index, 1);
    renderCart();
  }

  document.querySelectorAll('.add-to-cart').forEach((btn, i) => {
    btn.addEventListener('click', () => {
      const card = btn.closest('.product-card');
      const fileInput = card.querySelector('.file-upload');
      const colorSelect = card.querySelector('.color-select');
      
      if (!fileInput.files[0] || !colorSelect.value) {
        alert('Please upload a file and select a color!');
        return;
      }

      cart.push({
        name: card.querySelector('h3').innerText,
        color: colorSelect.value,
        fileName: fileInput.files[0].name,
      });
      renderCart();
    });
  });

  // STRIPE CHECKOUT
  const stripe = Stripe('YOUR_PUBLISHABLE_KEY');

  document.getElementById('checkout-button').addEventListener('click', async () => {
    if(cart.length === 0) { alert('Your cart is empty!'); return; }

    const response = await fetch('/create-checkout-session', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ items: cart.map(item => ({ name: item.name, price: 10, quantity: 1 })) })
    });

    const session = await response.json();
    stripe.redirectToCheckout({ sessionId: session.id });
  });
</script>

</body>
</html>
